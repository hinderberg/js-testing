<!DOCTYPE html>
<html>
  <head>
    <title>Title</title>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
    <script src="https://github.com/downloads/gnab/remark/remark-0.3.4.min.js" type="text/javascript"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js" type="text/javascript"></script>
    <script src="https://github.com/downloads/kjbekkelund/remark-bekk/bekk-0.0.3.js" type="text/javascript"></script>
    <link href="https://github.com/downloads/kjbekkelund/remark-bekk/bekk-0.0.3.css" type="text/css" rel="stylesheet">
    <style type="text/css" media="screen">
      #slideshow .slide .content.front-page h1 { width: 100%; }
      .slide p { padding: 0; margin: 1.1em 0; }
      .slide ul { padding: 0; margin: 1.1em 0; }
      .slide img { max-width: 100%; max-height: 600px; }
      #slideshow .slide .content ul li { padding-left: 1.3em; }
    </style>
  </head>
  <body>
    <textarea id="source">

.front-page

# Testing av JavaScript

## Testing og arkitektur

Kurs

Kim Joar Bekkelund og Tine Kleivane

29/05/2012

---

.agenda

# Agenda

* En agenda

---

# Utbytte 

* Prøve reelle eksempler på testing av js
  * Både gode og dårlige måter
  * Diskutere virkningene av denne typen testing
* Et forslag til struktur for å bygge opp nye js-applikasjoner
  * Struktur å måle andre rammeverk / egne applikasjoner mot

---

# Intro til Jasmine

    .javascript
    describe("My tests", function(){
      
      beforeEach(function(){
        this.color = "green";
      });

      afterEach(function(){
        this.color = "green";
      });
      
      it("looks green", function(){
        expect(this.color).toEqual("green");
      });
    
    });

* BDD-rammeverk
* Kan kjøre standalone eller som en del av maven
* Kan kjøre asynkrone kall med `runs` og `waits` 

---


.pushed

![](images/monolog_cropped.png)

# Målet

Dowstripped Twitter --> Monolog

---


# Views

* Et view eier et DOM-element, el`.
* Det er kun views som har lov til å røre DOM-en!

---

#Views

Simple.js

* http://kjbekkelund.github.com/simple/
* Rammeverket leter etter metoden `initialize` og kjører denne på `new ExtendedSimpleView`

Hvordan lage et nytt view: 
    
    .javascript
    BEKK.ExtendedSimpleView = Simple.View.extend({
      method: function(){
        //View logic & rendering
      }; 
    });

---

.middle.center

# Startup
https://github.com/kjbekkelund/js-tdd-kurs



---

# Oppgave 1

    .javascript
    describe("The user view", function(){

    it("should have a user when initialized", function(){
        var user = {};

        //Initialize a new view

        expect(view.user).toBeDefined();
    });



---

# Gjennomgang oppgave 

    .javascript
    Utfylt testing

---


# Views

* Et view eier et element `el`
* `template` inneholder ren html som skal inn i viewet. 
* `render` sitt ansvar er å interpolere data i template og plassere dette i `el`
	* Å rendre el til dom'en er IKKE viewet sin oppgave

Testhjelper:

    .javascript
    expect(view).toContainInTemplate("En string");

---

# Oppgave

    .javascript
    Test2


---


# Gjennomgang oppgave

    .javascript
    this

* Nevne lagarkitetur med egen render

---

# View.DOM

* `view.DOM()` er en selector-query med `el` som scope, ala `jQuery(selector, context)`
* Løsningen i `toContainInTemplate` blir for enkel ettersom den søker etter en string blant all html
* En intern selector gir også en løs kobling som mulig til DOM og åpner for å flytte rundt og bytte subviews


---


# Model

* Har ansvar for data og opphenting av denne
	* Kun modeller som har lov til å kommunisere med serveren
	
* initialize
	* url
* attr
* toJSON 

---

# Oppgave

    .javascript
    Test
---

# Gjennomgang oppgave 

    .javascript
    Utfylt test

---

# Model

* fetch med callback
* url

---

# Oppgave 
    
    .javascript
    Test

---

# Gjennomgang oppgave 

    .javascript
    Utfylt test

* Hastighet
* Avhengig av Twitter-resultat, både på innhold og tidsbruk. 500 ms kræsjer 1 av 3 ganger. 
# Testene blir vanskeligere, man må ta hensyn til hastighet. 
* Byggeprosessen: må ha et kjørende applikasjon i bygget dersom du skal teste js mot interne applikasjoner


---

# sinon.js

http://sinonjs.org/
Standalone test spies, stubs and mocks for JavaScript. No dependencies, works with any unit testing framework.
 
* Fake timers for setTimeout()
* Fake server & XHR
* Finnes mange tilpasninger til rammeverk, f.eks. Jasmine matchers


---

# fake Server

    .javascript
    // Setup
    this.server = sinon.fakeServer.create();

    //Teardown
    this.server.restore();

    //Response
    this.server.respondWith([statusCode, {header: header}, data]);


* "kopiering" av responsen i forrige Oppgave
* registerer ikke endringer i API'et

---

# Oppgave 

** OBS: endre til json igjen i simple.js


---

# gjennomgang oppgave

* Oppsett kan gi overhead

---

# testhelper.js

* Gå igjennom fakeServer()
* Fixtures
* Tenke på hvordan denne blir gitt ift oppgave 5

---

# Oppgave

---

# Gjennomgang av oppgave

---

# Events

* Hvordan det fungerer?
* Hvorfor det fungerer? (decoupling)
* Henvise tilbake til callback-oppgaven
* Hva skjer med ekstreme mengder callbacks

---

# Events

    .javascript
    Eksempel

---

# Oppgave 

---

# Gjennomgang av oppgave

---

# Globale events

*

---

# Oppgave  som ennå ikke er laget

---

# Gjennomgang av oppgave

---

# subviews 

* Oppslag innenfor views 

---

# Oppgave  som ennå ikke er laget

---

# Gjennomgang av oppgave

---

# Delegering av events 

* Oppslag innenfor views 

---

# Oppgave som ennå ikke er laget

---

# Gjennomgang av oppgave

---

The END










    </textarea>
    <div id="slideshow"></div>
  </body>
</html>
